this.b3=this.b3||{},function(){"use strict";b3.VERSION="0.2.0",b3.SUCCESS=1,b3.FAILURE=2,b3.RUNNING=3,b3.ERROR=4,b3.COMPOSITE="composite",b3.DECORATOR="decorator",b3.ACTION="action",b3.CONDITION="condition"}(),function(){"use strict";b3.createUUID=function(){for(var i=[],t="0123456789abcdef",e=0;36>e;e++)i[e]=t.substr(Math.floor(16*Math.random()),1);i[14]="4",i[19]=t.substr(3&i[19]|8,1),i[8]=i[13]=i[18]=i[23]="-";var r=i.join("");return r},b3.Class=function(i){var t=function(i){this.initialize(i)};return i&&(t.prototype=Object.create(i.prototype),t.prototype.constructor=t),t.prototype.initialize||(t.prototype.initialize=function(){}),t}}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Action),t=i.prototype;t.name="Error",t.tick=function(i){return b3.ERROR},b3.Error=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Action),t=i.prototype;t.name="Failer",t.tick=function(i){return b3.FAILURE},b3.Failer=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Action),t=i.prototype;t.name="Runner",t.tick=function(i){return b3.RUNNING},b3.Runner=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Action),t=i.prototype;t.name="Succeeder",t.tick=function(i){return b3.SUCCESS},b3.Succeeder=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Action),t=i.prototype;t.name="Wait",t.title="Wait <milliseconds>ms",t.parameters={milliseconds:0},t.__Action_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__Action_initialize(),this.endTime=i.milliseconds||0},t.open=function(i){var t=(new Date).getTime();i.blackboard.set("startTime",t,i.tree.id,this.id)},t.tick=function(i){var t=(new Date).getTime(),e=i.blackboard.get("startTime",i.tree.id,this.id);return t-e>this.endTime?b3.SUCCESS:b3.RUNNING},b3.Wait=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Composite),t=i.prototype;t.name="MemPriority",t.open=function(i){i.blackboard.set("runningChild",0,i.tree.id,this.id)},t.tick=function(i){for(var t=i.blackboard.get("runningChild",i.tree.id,this.id),e=t;e<this.children.length;e++){var r=this.children[e]._execute(i);if(r!==b3.FAILURE)return r===b3.RUNNING&&i.blackboard.set("runningChild",e,i.tree.id,this.id),r}return b3.FAILURE},b3.MemPriority=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Composite),t=i.prototype;t.name="MemSequence",t.open=function(i){i.blackboard.set("runningChild",0,i.tree.id,this.id)},t.tick=function(i){for(var t=i.blackboard.get("runningChild",i.tree.id,this.id),e=t;e<this.children.length;e++){var r=this.children[e]._execute(i);if(r!==b3.SUCCESS)return r===b3.RUNNING&&i.blackboard.set("runningChild",e,i.tree.id,this.id),r}return b3.SUCCESS},b3.MemSequence=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Composite),t=i.prototype;t.name="Priority",t.tick=function(i){for(var t=0;t<this.children.length;t++){var e=this.children[t]._execute(i);if(e!==b3.FAILURE)return e}return b3.FAILURE},b3.Priority=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Composite),t=i.prototype;t.name="Sequence",t.tick=function(i){for(var t=0;t<this.children.length;t++){var e=this.children[t]._execute(i);if(e!==b3.SUCCESS)return e}return b3.SUCCESS},b3.Sequence=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="Inverter",t.tick=function(i){if(!this.child)return b3.ERROR;var t=this.child._execute(i);return t==b3.SUCCESS?t=b3.FAILURE:t==b3.FAILURE&&(t=b3.SUCCESS),t},b3.Inverter=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="Limiter",t.title="Limit <maxLoop> Activations",t.parameters={maxLoop:1},t.__Decorator_initialize=t.initialize,t.initialize=function(i){if(i=i||{},this.__Decorator_initialize(i),!i.maxLoop)throw"maxLoop parameter in Limiter decorator is an obligatory parameter";this.maxLoop=i.maxLoop},t.open=function(i){i.blackboard.set("i",0,i.tree.id,this.id)},t.tick=function(i){if(!this.child)return b3.ERROR;var t=i.blackboard.get("i",i.tree.id,this.id);if(t<this.maxLoop){var e=this.child._execute(i);return(e==b3.SUCCESS||e==b3.FAILURE)&&i.blackboard.set("i",t+1,i.tree.id,this.id),e}return b3.FAILURE},b3.Limiter=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="MaxTime",t.title="Max <maxTime>ms",t.parameters={maxTime:0},t.__Decorator_initialize=t.initialize,t.initialize=function(i){if(i=i||{},this.__Decorator_initialize(i),!i.maxTime)throw"maxTime parameter in MaxTime decorator is an obligatory parameter";this.maxTime=i.maxTime},t.open=function(i){var t=(new Date).getTime();i.blackboard.set("startTime",t,i.tree.id,this.id)},t.tick=function(i){if(!this.child)return b3.ERROR;var t=(new Date).getTime(),e=i.blackboard.get("startTime",i.tree.id,this.id),r=this.child._execute(i);return t-e>this.maxTime?b3.FAILURE:r},b3.MaxTime=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="RepeatUntilFailure",t.title="Repeat Until Failure",t.parameters={maxLoop:-1},t.__Decorator_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__Decorator_initialize(i),this.maxLoop=i.maxLoop||-1},t.open=function(i){i.blackboard.set("i",0,i.tree.id,this.id)},t.tick=function(i){if(!this.child)return b3.ERROR;for(var t=i.blackboard.get("i",i.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||t<this.maxLoop)&&(e=this.child._execute(i),e==b3.SUCCESS);)t++;return t=i.blackboard.set("i",t,i.tree.id,this.id),e},b3.RepeatUntilFailure=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="RepeatUntilSuccess",t.title="Repeat Until Success",t.parameters={maxLoop:-1},t.__Decorator_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__Decorator_initialize(i),this.maxLoop=i.maxLoop||-1},t.open=function(i){i.blackboard.set("i",0,i.tree.id,this.id)},t.tick=function(i){if(!this.child)return b3.ERROR;for(var t=i.blackboard.get("i",i.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||t<this.maxLoop)&&(e=this.child._execute(i),e==b3.FAILURE);)t++;return t=i.blackboard.set("i",t,i.tree.id,this.id),e},b3.RepeatUntilSuccess=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.Decorator),t=i.prototype;t.name="Repeater",t.title="Repeat <maxLoop>x",t.parameters={maxLoop:-1},t.__Decorator_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__Decorator_initialize(i),this.maxLoop=i.maxLoop||-1},t.open=function(i){i.blackboard.set("i",0,i.tree.id,this.id)},t.tick=function(i){if(!this.child)return b3.ERROR;for(var t=i.blackboard.get("i",i.tree.id,this.id),e=b3.SUCCESS;(this.maxLoop<0||t<this.maxLoop)&&(e=this.child._execute(i),e==b3.SUCCESS||e==b3.FAILURE);)t++;return t=i.blackboard.set("i",t,i.tree.id,this.id),e},b3.Repeater=i}(),function(){"use strict";var i=b3.Class(b3.BaseNode),t=i.prototype;t.category=b3.ACTION,t.__BaseNode_initialize=t.initialize,t.initialize=function(){this.__BaseNode_initialize()},b3.Action=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(),t=i.prototype;t.name=null,t.category=null,t.title=null,t.description=null,t.parameters=null,t.properties=null,t.initialize=function(){this.id=b3.createUUID(),this.title=this.title||this.name,this.description="",this.parameters={},this.properties={}},t._execute=function(i){this._enter(i),i.blackboard.get("isOpen",i.tree.id,this.id)||this._open(i);var t=this._tick(i);return t!==b3.RUNNING&&this._close(i),this._exit(i),t},t._enter=function(i){i._enterNode(this),this.enter(i)},t._open=function(i){i._openNode(this),i.blackboard.set("isOpen",!0,i.tree.id,this.id),this.open(i)},t._tick=function(i){return i._tickNode(this),this.tick(i)},t._close=function(i){i._closeNode(this),i.blackboard.set("isOpen",!1,i.tree.id,this.id),this.close(i)},t._exit=function(i){i._exitNode(this),this.exit(i)},t.enter=function(i){},t.open=function(i){},t.tick=function(i){},t.close=function(i){},t.exit=function(i){},b3.BaseNode=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(),t=i.prototype;t.initialize=function(){this.id=b3.createUUID(),this.title="The behavior tree",this.description="Default description",this.properties={},this.root=null,this.debug=null},t.load=function(i,t){t=t||{},this.title=i.title||this.title,this.description=i.description||this.description,this.properties=i.properties||this.properties;var e,r,o,n={};for(e in i.nodes){r=i.nodes[e];var s;if(r.name in t)s=t[r.name];else{if(!(r.name in b3))throw new EvalError('BehaviorTree.load: Invalid node name + "'+r.name+'".');s=b3[r.name]}o=new s(r.properties),o.id=r.id||o.id,o.title=r.title||o.title,o.description=r.description||o.description,o.properties=r.properties||o.properties,n[e]=o}for(e in i.nodes)if(r=i.nodes[e],o=n[e],o.category===b3.COMPOSITE&&r.children)for(var a=0;a<r.children.length;a++){var c=r.children[a];o.children.push(n[c])}else o.category===b3.DECORATOR&&r.child&&(o.child=n[r.child]);this.root=n[i.root]},t.dump=function(){var i={},t=[];if(i.title=this.title,i.description=this.description,i.root=this.root?this.root.id:null,i.properties=this.properties,i.nodes={},i.custom_nodes=[],!this.root)return i;for(var e=[this.root];e.length>0;){var r=e.pop(),o={};o.id=r.id,o.name=r.name,o.title=r.title,o.description=r.description,o.properties=r.properties,o.parameters=r.parameters;var n=r.constructor&&r.constructor.prototype,s=n&&n.name||r.name;if(!b3[s]&&t.indexOf(s)<0){var a={};a.name=s,a.title=n&&n.title||r.title,a.category=r.category,t.push(s),i.custom_nodes.push(a)}if(r.category===b3.COMPOSITE&&r.children){for(var c=[],h=r.children.length-1;h>=0;h--)c.push(r.children[h].id),e.push(r.children[h]);o.children=c}else r.category===b3.DECORATOR&&r.child&&(e.push(r.child),o.child=r.child.id);i.nodes[r.id]=o}return i},t.tick=function(i,t){if(!t)throw"The blackboard parameter is obligatory and must be an instance of b3.Blackboard";var e=new b3.Tick;e.debug=this.debug,e.target=i,e.blackboard=t,e.tree=this;var r,o=this.root._execute(e),n=t.get("openNodes",this.id),s=e._openNodes.slice(0),a=0;for(r=0;r<Math.min(n.length,s.length)&&(a=r+1,n[r]===s[r]);r++);for(r=n.length-1;r>=a;r--)n[r]._close(e);return t.set("openNodes",s,this.id),t.set("nodeCount",e._nodeCount,this.id),o},b3.BehaviorTree=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(),t=i.prototype;t.initialize=function(){this._baseMemory={},this._treeMemory={}},t._getTreeMemory=function(i){return this._treeMemory[i]||(this._treeMemory[i]={nodeMemory:{},openNodes:[],traversalDepth:0,traversalCycle:0}),this._treeMemory[i]},t._getNodeMemory=function(i,t){var e=i.nodeMemory;return e[t]||(e[t]={}),e[t]},t._getMemory=function(i,t){var e=this._baseMemory;return i&&(e=this._getTreeMemory(i),t&&(e=this._getNodeMemory(e,t))),e},t.set=function(i,t,e,r){var o=this._getMemory(e,r);o[i]=t},t.get=function(i,t,e){var r=this._getMemory(t,e);return r[i]},b3.Blackboard=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.BaseNode),t=i.prototype;t.category=b3.COMPOSITE,t.__BaseNode_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__BaseNode_initialize(),this.children=(i.children||[]).slice(0)},b3.Composite=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.BaseNode),t=i.prototype;t.category=b3.CONDITION,t.__BaseNode_initialize=t.initialize,t.initialize=function(){this.__BaseNode_initialize()},b3.Condition=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(b3.BaseNode),t=i.prototype;t.category=b3.DECORATOR,t.__BaseNode_initialize=t.initialize,t.initialize=function(i){i=i||{},this.__BaseNode_initialize(),this.child=i.child||null},b3.Decorator=i}(),this.b3=this.b3||{},function(){"use strict";var i=b3.Class(),t=i.prototype;t.initialize=function(){this.tree=null,this.debug=null,this.target=null,this.blackboard=null,this._openNodes=[],this._nodeCount=0},t._enterNode=function(i){this._nodeCount++,this._openNodes.push(i)},t._openNode=function(i){},t._tickNode=function(i){},t._closeNode=function(i){this._openNodes.pop()},t._exitNode=function(i){},b3.Tick=i}();