this.b3=this.b3||{},function(){"use strict";b3.VERSION="0.2.0",b3.SUCCESS=1,b3.FAILURE=2,b3.RUNNING=3,b3.ERROR=4,b3.COMPOSITE="composite",b3.DECORATOR="decorator",b3.ACTION="action",b3.CONDITION="condition"}(),function(){"use strict";b3.createUUID=function(){for(var t=[],i="0123456789abcdef",e=0;36>e;e++)t[e]=i.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=i.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-";var r=t.join("");return r},b3.Class=function(t,i){var e=function(t){this.initialize(t||{})};if(t&&(e.prototype=Object.create(t.prototype),e.prototype.constructor=e),e.prototype.initialize||(e.prototype.initialize=function(){}),i)for(var r in i)e.prototype[r]=i[r];return e}}(),function(){"use strict";b3.BehaviorTree=b3.Class(null,{id:null,title:null,description:null,properties:null,root:null,debug:null,initialize:function(){this.id=b3.createUUID(),this.title="The behavior tree",this.description="Default description",this.properties={},this.root=null,this.debug=null},load:function(t,i){i=i||{},this.title=t.title||this.title,this.description=t.description||this.description,this.properties=t.properties||this.properties;var e,r,n,o={};for(e in t.nodes){r=t.nodes[e];var s;if(r.name in i)s=i[r.name];else{if(!(r.name in b3))throw new EvalError('BehaviorTree.load: Invalid node name + "'+r.name+'".');s=b3[r.name]}n=new s(r.properties),n.id=r.id||n.id,n.title=r.title||n.title,n.description=r.description||n.description,n.properties=r.properties||n.properties,o[e]=n}for(e in t.nodes)if(r=t.nodes[e],n=o[e],n.category===b3.COMPOSITE&&r.children)for(var a=0;a<r.children.length;a++){var c=r.children[a];n.children.push(o[c])}else n.category===b3.DECORATOR&&r.child&&(n.child=o[r.child]);this.root=o[t.root]},dump:function(){var t={},i=[];if(t.title=this.title,t.description=this.description,t.root=this.root?this.root.id:null,t.properties=this.properties,t.nodes={},t.custom_nodes=[],!this.root)return t;for(var e=[this.root];e.length>0;){var r=e.pop(),n={};n.id=r.id,n.name=r.name,n.title=r.title,n.description=r.description,n.properties=r.properties,n.parameters=r.parameters;var o=r.constructor&&r.constructor.prototype,s=o&&o.name||r.name;if(!b3[s]&&i.indexOf(s)<0){var a={};a.name=s,a.title=o&&o.title||r.title,a.category=r.category,i.push(s),t.custom_nodes.push(a)}if(r.category===b3.COMPOSITE&&r.children){for(var c=[],l=r.children.length-1;l>=0;l--)c.push(r.children[l].id),e.push(r.children[l]);n.children=c}else r.category===b3.DECORATOR&&r.child&&(e.push(r.child),n.child=r.child.id);t.nodes[r.id]=n}return t},tick:function(t,i){if(!i)throw"The blackboard parameter is obligatory and must be an instance of b3.Blackboard";var e=new b3.Tick;e.debug=this.debug,e.target=t,e.blackboard=i,e.tree=this;var r,n=this.root._execute(e),o=i.get("openNodes",this.id),s=e._openNodes.slice(0),a=0;for(r=0;r<Math.min(o.length,s.length)&&(a=r+1,o[r]===s[r]);r++);for(r=o.length-1;r>=a;r--)o[r]._close(e);return i.set("openNodes",s,this.id),i.set("nodeCount",e._nodeCount,this.id),n}})}(),function(){"use strict";b3.Tick=b3.Class(null,{tree:null,debug:null,target:null,blackboard:null,_openNodes:[],_nodeCount:0,initialize:function(){this.tree=null,this.debug=null,this.target=null,this.blackboard=null,this._openNodes=[],this._nodeCount=0},_enterNode:function(t){this._nodeCount++,this._openNodes.push(t)},_openNode:function(t){},_tickNode:function(t){},_closeNode:function(t){this._openNodes.pop()},_exitNode:function(t){}})}(),function(){"use strict";b3.Blackboard=b3.Class(null,{initialize:function(){this._baseMemory={},this._treeMemory={}},_getTreeMemory:function(t){return this._treeMemory[t]||(this._treeMemory[t]={nodeMemory:{},openNodes:[],traversalDepth:0,traversalCycle:0}),this._treeMemory[t]},_getNodeMemory:function(t,i){var e=t.nodeMemory;return e[i]||(e[i]={}),e[i]},_getMemory:function(t,i){var e=this._baseMemory;return t&&(e=this._getTreeMemory(t),i&&(e=this._getNodeMemory(e,i))),e},set:function(t,i,e,r){var n=this._getMemory(e,r);n[t]=i},get:function(t,i,e){var r=this._getMemory(i,e);return r[t]}})}(),function(){"use strict";b3.BaseNode=b3.Class(null,{id:null,name:null,category:null,title:null,description:null,parameters:null,properties:null,initialize:function(t){this.id=b3.createUUID(),this.title=this.title||this.name,this.description="",this.parameters={},this.properties={}},_execute:function(t){this._enter(t),t.blackboard.get("isOpen",t.tree.id,this.id)||this._open(t);var i=this._tick(t);return i!==b3.RUNNING&&this._close(t),this._exit(t),i},_enter:function(t){t._enterNode(this),this.enter(t)},_open:function(t){t._openNode(this),t.blackboard.set("isOpen",!0,t.tree.id,this.id),this.open(t)},_tick:function(t){return t._tickNode(this),this.tick(t)},_close:function(t){t._closeNode(this),t.blackboard.set("isOpen",!1,t.tree.id,this.id),this.close(t)},_exit:function(t){t._exitNode(this),this.exit(t)},enter:function(t){},open:function(t){},tick:function(t){},close:function(t){},exit:function(t){}})}(),function(){"use strict";b3.Action=b3.Class(b3.BaseNode,{category:b3.ACTION,initialize:function(t){b3.BaseNode.prototype.initialize.call(this)}})}(),function(){"use strict";b3.Composite=b3.Class(b3.BaseNode,{category:b3.COMPOSITE,initialize:function(t){b3.BaseNode.prototype.initialize.call(this),this.children=(t.children||[]).slice(0)}})}(),function(){"use strict";b3.Condition=b3.Class(b3.BaseNode,{category:b3.CONDITION,initialize:function(t){b3.BaseNode.prototype.initialize.call(this)}})}(),function(){"use strict";b3.Decorator=b3.Class(b3.BaseNode,{category:b3.DECORATOR,initialize:function(t){b3.BaseNode.prototype.initialize.call(this),this.child=t.child||null}})}(),function(){"use strict";b3.MemPriority=b3.Class(b3.Composite,{name:"MemPriority",open:function(t){t.blackboard.set("runningChild",0,t.tree.id,this.id)},tick:function(t){for(var i=t.blackboard.get("runningChild",t.tree.id,this.id),e=i;e<this.children.length;e++){var r=this.children[e]._execute(t);if(r!==b3.FAILURE)return r===b3.RUNNING&&t.blackboard.set("runningChild",e,t.tree.id,this.id),r}return b3.FAILURE}})}(),function(){"use strict";b3.MemSequence=b3.Class(b3.Composite,{name:"MemSequence",open:function(t){t.blackboard.set("runningChild",0,t.tree.id,this.id)},tick:function(t){for(var i=t.blackboard.get("runningChild",t.tree.id,this.id),e=i;e<this.children.length;e++){var r=this.children[e]._execute(t);if(r!==b3.SUCCESS)return r===b3.RUNNING&&t.blackboard.set("runningChild",e,t.tree.id,this.id),r}return b3.SUCCESS}})}(),function(){"use strict";b3.Priority=b3.Class(b3.Composite,{name:"Priority",tick:function(t){for(var i=0;i<this.children.length;i++){var e=this.children[i]._execute(t);if(e!==b3.FAILURE)return e}return b3.FAILURE}})}(),function(){"use strict";b3.Sequence=b3.Class(b3.Composite,{name:"Sequence",tick:function(t){for(var i=0;i<this.children.length;i++){var e=this.children[i]._execute(t);if(e!==b3.SUCCESS)return e}return b3.SUCCESS}})}(),function(){"use strict";b3.Inverter=b3.Class(b3.Decorator,{name:"Inverter",tick:function(t){if(!this.child)return b3.ERROR;var i=this.child._execute(t);return i==b3.SUCCESS?i=b3.FAILURE:i==b3.FAILURE&&(i=b3.SUCCESS),i}})}(),function(){"use strict";b3.Limiter=b3.Class(b3.Decorator,{name:"Limiter",title:"Limit <maxLoop> Activations",parameters:{maxLoop:1},initialize:function(t){if(b3.Decorator.prototype.initialize.call(this,t),!t.maxLoop)throw"maxLoop parameter in Limiter decorator is an obligatory parameter";this.maxLoop=t.maxLoop},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;var i=t.blackboard.get("i",t.tree.id,this.id);if(i<this.maxLoop){var e=this.child._execute(t);return(e==b3.SUCCESS||e==b3.FAILURE)&&t.blackboard.set("i",i+1,t.tree.id,this.id),e}return b3.FAILURE}})}(),function(){"use strict";b3.MaxTime=b3.Class(b3.Decorator,{name:"MaxTime",title:"Max <maxTime>ms",parameters:{maxTime:0},initialize:function(t){if(b3.Decorator.prototype.initialize.call(this,t),!t.maxTime)throw"maxTime parameter in MaxTime decorator is an obligatory parameter";this.maxTime=t.maxTime},open:function(t){var i=(new Date).getTime();t.blackboard.set("startTime",i,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;var i=(new Date).getTime(),e=t.blackboard.get("startTime",t.tree.id,this.id),r=this.child._execute(t);return i-e>this.maxTime?b3.FAILURE:r}})}(),function(){"use strict";b3.RepeatUntilFailure=b3.Class(b3.Decorator,{name:"RepeatUntilFailure",title:"Repeat Until Failure",parameters:{maxLoop:-1},initialize:function(t){b3.Decorator.prototype.initialize.call(this,t),this.maxLoop=t.maxLoop||-1},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;for(var i=t.blackboard.get("i",t.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||i<this.maxLoop)&&(e=this.child._execute(t),e==b3.SUCCESS);)i++;return i=t.blackboard.set("i",i,t.tree.id,this.id),e}})}(),function(){"use strict";b3.RepeatUntilSuccess=b3.Class(b3.Decorator,{name:"RepeatUntilSuccess",title:"Repeat Until Success",parameters:{maxLoop:-1},initialize:function(t){b3.Decorator.prototype.initialize.call(this,t),this.maxLoop=t.maxLoop||-1},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;for(var i=t.blackboard.get("i",t.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||i<this.maxLoop)&&(e=this.child._execute(t),e==b3.FAILURE);)i++;return i=t.blackboard.set("i",i,t.tree.id,this.id),e}})}(),function(){"use strict";b3.Repeater=b3.Class(b3.Decorator,{name:"Repeater",title:"Repeat <maxLoop>x",parameters:{maxLoop:-1},initialize:function(t){b3.Decorator.prototype.initialize.call(this,t),this.maxLoop=t.maxLoop||-1},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;for(var i=t.blackboard.get("i",t.tree.id,this.id),e=b3.SUCCESS;(this.maxLoop<0||i<this.maxLoop)&&(e=this.child._execute(t),e==b3.SUCCESS||e==b3.FAILURE);)i++;return i=t.blackboard.set("i",i,t.tree.id,this.id),e}})}(),function(){"use strict";b3.Error=b3.Class(b3.Action,{name:"Error",tick:function(t){return b3.ERROR}})}(),function(){"use strict";b3.Failer=b3.Class(b3.Action,{name:"Failer",tick:function(t){return b3.FAILURE}})}(),function(){"use strict";b3.Runner=b3.Class(b3.Action,{name:"Runner",tick:function(t){return b3.RUNNING}})}(),function(){"use strict";b3.Succeeder=b3.Class(b3.Action,{name:"Succeeder",tick:function(t){return b3.SUCCESS}})}(),function(){"use strict";b3.Wait=b3.Class(b3.Action,{name:"Wait",title:"Wait <milliseconds>ms",parameters:{milliseconds:0},initialize:function(t){t=t||{},b3.Action.prototype.initialize.call(this),this.endTime=t.milliseconds||0},open:function(t){var i=(new Date).getTime();t.blackboard.set("startTime",i,t.tree.id,this.id)},tick:function(t){var i=(new Date).getTime(),e=t.blackboard.get("startTime",t.tree.id,this.id);return i-e>this.endTime?b3.SUCCESS:b3.RUNNING}})}();